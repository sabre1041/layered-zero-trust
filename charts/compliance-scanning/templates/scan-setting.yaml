apiVersion: compliance.openshift.io/v1alpha1
kind: ScanSetting
metadata:
  name: {{ .Values.compliance.scanSetting.name }}
  namespace: openshift-compliance
  annotations:
    argocd.argoproj.io/sync-wave: '-10'
  labels:
    app.kubernetes.io/component: compliance-scan-setting
# Enable automatic application of remediations
autoApplyRemediations: {{ .Values.compliance.scanSetting.autoApplyRemediations }}
# Use default-auto-apply annotation for automatic remediation
autoUpdateRemediations: true
# Scanning schedule (empty means manual trigger)
{{- if .Values.compliance.scanSetting.schedule }}
schedule: {{ .Values.compliance.scanSetting.schedule | quote }}
{{- end }}
# Scanner pod tolerations to run on all nodes including masters
scanTolerations:
  {{- toYaml .Values.compliance.scanSetting.scanTolerations | nindent 4 }}
# Resource constraints for scanner pods
resources:
  {{- toYaml .Values.compliance.scanSetting.resources | nindent 4 }}
# Node selector for scanner pods (if specified)
{{- if .Values.compliance.scanSetting.nodeSelector }}
nodeSelector:
  {{- toYaml .Values.compliance.scanSetting.nodeSelector | nindent 4 }}
{{- end }}
# PVC for storing scan results
{{- if .Values.compliance.storage.enabled }}
rawResultStorage:
  pvAccessModes:
    - {{ .Values.compliance.storage.pvc.accessMode }}
  rotation: 5
  size: {{ .Values.compliance.storage.pvc.size }}
  {{- if .Values.compliance.storage.pvc.storageClass }}
  storageClassName: {{ .Values.compliance.storage.pvc.storageClass }}
  {{- end }}
{{- end }}
