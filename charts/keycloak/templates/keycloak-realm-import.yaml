{{- if or .Values.keycloak.defaultConfig .Values.keycloak.realms }}
{{/*
Merge realms
*/}}
{{- $realms := .Values.keycloak.realms | default list }}
{{- if .Values.keycloak.defaultConfig }}
{{- $realms = append $realms .Values.keycloak.defaultRealm }}
{{- end }}
{{- range $realms }}
---
apiVersion: k8s.keycloak.org/v2alpha1
kind: KeycloakRealmImport
metadata:
  name: "{{ .realm }}-realm-import"
  namespace: "{{ $.Release.Namespace }}"
spec:
  keycloakCRName: keycloak
  realm:
{{- toYaml . | nindent 4 }}
{{- end }}
{{- end }}