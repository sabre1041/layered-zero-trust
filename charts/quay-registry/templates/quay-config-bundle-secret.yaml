apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.quay.configBundleSecret.name }}
  namespace: {{ .Values.quay.namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "7"  # Layer 1: Create base config secret (template)
type: Opaque
stringData:
  config.yaml: |
    FEATURE_USER_INITIALIZE: true
    FEATURE_GENERAL_OCI_SUPPORT: true
    BROWSER_API_CALLS_XHR_ONLY: false
    SUPER_USERS:
    - {{ .Values.quay.setup.admin.name }}
    FEATURE_USER_CREATION: true
    ALLOW_PULLS_WITHOUT_STRICT_LOGGING: false
    AUTHENTICATION_TYPE: Database
    DEFAULT_TAG_EXPIRATION: 2w
    ENTERPRISE_LOGO_URL: /static/img/RH_Logo_Quay_Black_UX-
    FEATURE_BUILD_SUPPORT: false
    FEATURE_DIRECT_LOGIN: true
    FEATURE_MAILING: false
    REGISTRY_TITLE: Red Hat Quay
    REGISTRY_TITLE_SHORT: Quay
    TEAM_RESYNC_STALE_TIME: 60m
    TESTING: false
    CREATE_NAMESPACE_ON_PUSH: true
    # NooBaa Multicloud Object Gateway (MOG) S3-compatible storage configuration
    # This is a template - actual secret with real credentials is created by quay-s3-credentials-setup job
    DISTRIBUTED_STORAGE_CONFIG:
      default:
        - S3Storage
        - host: s3.openshift-storage.svc.cluster.local
          port: 443
          storage_path: /datastorage/registry
          s3_access_key: PLACEHOLDER_ACCESS_KEY
          s3_secret_key: PLACEHOLDER_SECRET_KEY
          s3_bucket: PLACEHOLDER_BUCKET_NAME
    DISTRIBUTED_STORAGE_DEFAULT_LOCATIONS: []
    DISTRIBUTED_STORAGE_PREFERENCE:
      - default
