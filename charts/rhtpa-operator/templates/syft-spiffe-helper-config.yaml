{{- if .Values.rhtpa.enabled }}
{{- if .Values.rhtpa.syft.enabled }}
{{- if .Values.rhtpa.syft.spiffe.enabled }}
---
# SPIFFE Helper Configuration for SYFT SBOM Generator
# Generates JWT tokens for authenticating with Vault
apiVersion: v1
kind: ConfigMap
metadata:
  name: syft-spiffe-helper-config
  namespace: {{ .Values.rhtpa.namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "19"
data:
  helper.conf: |
    agent_address = "/spiffe-workload-api/spire-agent.sock"
    cmd = ""
    cmd_args = ""
    cert_dir = "/run/secrets/spiffe"
    renew_signal = ""
    svid_file_name = "svid.pem"
    svid_key_file_name = "svid_key.pem"
    svid_bundle_file_name = "bundle.pem"
    
    jwt_svids = [{
      jwt_audience = "{{ .Values.rhtpa.syft.spiffe.audience }}"
      jwt_svid_file_name = "jwt.token"
    }]
{{- end }}
{{- end }}
{{- end }}

